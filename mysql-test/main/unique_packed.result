create database dbt3;
use dbt3;
SET @save_tmp_table_size= @@tmp_table_size;
CREATE VIEW v1 AS SELECT DISTINCT c_name as name FROM customer, orders WHERE c_custkey=o_custkey;
#
# The two queries should return the same result
#
SELECT COUNT(*) FROM v1;
COUNT(*)
100
SELECT COUNT(DISTINCT c_name) FROM customer, orders WHERE c_custkey=o_custkey;
COUNT(DISTINCT c_name)
100
#
# The two queries should return the same result
#
SELECT GROUP_CONCAT(name) FROM v1;
GROUP_CONCAT(name)
Customer#000000001,Customer#000000002,Customer#000000004,Customer#000000005,Customer#000000007,Customer#000000008,Customer#000000010,Customer#000000011,Customer#000000013,Customer#000000014,Customer#000000016,Customer#000000017,Customer#000000019,Customer#000000020,Customer#000000022,Customer#000000023,Customer#000000025,Customer#000000026,Customer#000000028,Customer#000000029,Customer#000000031,Customer#000000032,Customer#000000034,Customer#000000035,Customer#000000037,Customer#000000038,Customer#000000040,Customer#000000041,Customer#000000043,Customer#000000044,Customer#000000046,Customer#000000047,Customer#000000049,Customer#000000050,Customer#000000052,Customer#000000053,Customer#000000055,Customer#000000056,Customer#000000058,Customer#000000059,Customer#000000061,Customer#000000062,Customer#000000064,Customer#000000065,Customer#000000067,Customer#000000068,Customer#000000070,Customer#000000071,Customer#000000073,Customer#000000074,Customer#000000076,Customer#000000077,Customer#000000079,Customer#000000080,Customer#000000082,Customer#000000083,Customer#000000085,Customer#000000086,Customer#000000088,Customer#000000089,Customer#000000091,Customer#000000092,Customer#000000094,Customer#000000095,Customer#000000097,Customer#000000098,Customer#000000100,Customer#000000101,Customer#000000103,Customer#000000104,Customer#000000106,Customer#000000107,Customer#000000109,Customer#000000110,Customer#000000112,Customer#000000113,Customer#000000115,Customer#000000116,Customer#000000118,Customer#000000119,Customer#000000121,Customer#000000122,Customer#000000124,Customer#000000125,Customer#000000127,Customer#000000128,Customer#000000130,Customer#000000131,Customer#000000133,Customer#000000134,Customer#000000136,Customer#000000137,Customer#000000139,Customer#000000140,Customer#000000142,Customer#000000143,Customer#000000145,Customer#000000146,Customer#000000148,Customer#000000149
SELECT GROUP_CONCAT(DISTINCT c_name) FROM customer, orders WHERE c_custkey=o_custkey;
GROUP_CONCAT(DISTINCT c_name)
Customer#000000001,Customer#000000002,Customer#000000004,Customer#000000005,Customer#000000007,Customer#000000008,Customer#000000010,Customer#000000011,Customer#000000013,Customer#000000014,Customer#000000016,Customer#000000017,Customer#000000019,Customer#000000020,Customer#000000022,Customer#000000023,Customer#000000025,Customer#000000026,Customer#000000028,Customer#000000029,Customer#000000031,Customer#000000032,Customer#000000034,Customer#000000035,Customer#000000037,Customer#000000038,Customer#000000040,Customer#000000041,Customer#000000043,Customer#000000044,Customer#000000046,Customer#000000047,Customer#000000049,Customer#000000050,Customer#000000052,Customer#000000053,Customer#000000055,Customer#000000056,Customer#000000058,Customer#000000059,Customer#000000061,Customer#000000062,Customer#000000064,Customer#000000065,Customer#000000067,Customer#000000068,Customer#000000070,Customer#000000071,Customer#000000073,Customer#000000074,Customer#000000076,Customer#000000077,Customer#000000079,Customer#000000080,Customer#000000082,Customer#000000083,Customer#000000085,Customer#000000086,Customer#000000088,Customer#000000089,Customer#000000091,Customer#000000092,Customer#000000094,Customer#000000095,Customer#000000097,Customer#000000098,Customer#000000100,Customer#000000101,Customer#000000103,Customer#000000104,Customer#000000106,Customer#000000107,Customer#000000109,Customer#000000110,Customer#000000112,Customer#000000113,Customer#000000115,Customer#000000116,Customer#000000118,Customer#000000119,Customer#000000121,Customer#000000122,Customer#000000124,Customer#000000125,Customer#000000127,Customer#000000128,Customer#000000130,Customer#000000131,Customer#000000133,Customer#000000134,Customer#000000136,Customer#000000137,Customer#000000139,Customer#000000140,Customer#000000142,Customer#000000143,Customer#000000145,Customer#000000146,Customer#000000148,Customer#000000149
DROP VIEW v1;
CREATE VIEW v1 AS SELECT DISTINCT p_mfgr, p_brand FROM part;
#
# The two queries should return the same result
#
SELECT GROUP_CONCAT(p_brand order by p_brand) FROM v1 GROUP BY p_mfgr;
GROUP_CONCAT(p_brand order by p_brand)
Brand#11,Brand#12,Brand#13,Brand#14,Brand#15
Brand#21,Brand#22,Brand#23,Brand#24,Brand#25
Brand#31,Brand#32,Brand#33,Brand#34,Brand#35
Brand#41,Brand#42,Brand#43,Brand#44,Brand#45
Brand#51,Brand#52,Brand#53,Brand#54,Brand#55
SELECT GROUP_CONCAT(DISTINCT p_brand) FROM part GROUP BY p_mfgr;
GROUP_CONCAT(DISTINCT p_brand)
Brand#11,Brand#12,Brand#13,Brand#14,Brand#15
Brand#21,Brand#22,Brand#23,Brand#24,Brand#25
Brand#31,Brand#32,Brand#33,Brand#34,Brand#35
Brand#41,Brand#42,Brand#43,Brand#44,Brand#45
Brand#51,Brand#52,Brand#53,Brand#54,Brand#55
#
# The two queries should return the same result
#
SELECT COUNT(*) FROM v1 GROUP BY p_mfgr;
COUNT(*)
5
5
5
5
5
SELECT COUNT(DISTINCT p_brand) FROM part GROUP BY p_mfgr;
COUNT(DISTINCT p_brand)
5
5
5
5
5
DROP VIEW v1;
CREATE VIEW v1 AS
SELECT DISTINCT p_mfgr, p_name FROM lineitem l, part p
WHERE l.l_partkey= p.p_partkey;
SELECT p_mfgr, COUNT(*) FROM v1 GROUP BY p_mfgr;
p_mfgr	COUNT(*)
Manufacturer#1	40
Manufacturer#2	36
Manufacturer#3	45
Manufacturer#4	37
Manufacturer#5	42
#
# The two queries should return the same result as the above one
#
SELECT p_mfgr, COUNT(DISTINCT p_name) FROM lineitem l, part p
WHERE l.l_partkey= p.p_partkey
GROUP BY p.p_mfgr;
p_mfgr	COUNT(DISTINCT p_name)
Manufacturer#1	40
Manufacturer#2	36
Manufacturer#3	45
Manufacturer#4	37
Manufacturer#5	42
SET tmp_table_size=1024;
#
# merge_walk() get called, that is merging of sorted chunks of file happens
#
SELECT p_mfgr, COUNT(DISTINCT p_name) FROM lineitem l, part p
WHERE l.l_partkey= p.p_partkey
GROUP BY p.p_mfgr;
p_mfgr	COUNT(DISTINCT p_name)
Manufacturer#1	40
Manufacturer#2	36
Manufacturer#3	45
Manufacturer#4	37
Manufacturer#5	42
SET tmp_table_size = @save_tmp_table_size;
DROP VIEW v1;
# The result should be 200
SELECT COUNT(DISTINCT p_name) FROM lineitem l, part p;
COUNT(DISTINCT p_name)
200
#
# merge_many_buffers get called, followed by merge_walk()
#
SET tmp_table_size=1024;
SELECT COUNT(DISTINCT p_name) FROM lineitem l, part p;
COUNT(DISTINCT p_name)
200
SET tmp_table_size = @save_tmp_table_size;
CREATE VIEW v1 AS SELECT DISTINCT n_name, c_name FROM customer, orders, nation
WHERE o_custkey= c_custkey and c_nationkey= n_nationkey;
#
# The two queries should return the same result
#
SELECT n_name, GROUP_CONCAT(c_name), COUNT(c_name) FROM v1 GROUP BY n_name;
n_name	GROUP_CONCAT(c_name)	COUNT(c_name)
ALGERIA	Customer#000000086,Customer#000000073,Customer#000000080,Customer#000000076,Customer#000000029	5
ARGENTINA	Customer#000000059,Customer#000000014,Customer#000000106	3
BRAZIL	Customer#000000101,Customer#000000047,Customer#000000092,Customer#000000017	4
CANADA	Customer#000000005,Customer#000000040,Customer#000000122,Customer#000000013,Customer#000000022,Customer#000000064,Customer#000000146,Customer#000000023	8
CHINA	Customer#000000019,Customer#000000082,Customer#000000007,Customer#000000124,Customer#000000118	5
EGYPT	Customer#000000128,Customer#000000074,Customer#000000140,Customer#000000004	4
ETHIOPIA	Customer#000000085,Customer#000000010	2
FRANCE	Customer#000000046,Customer#000000050	2
GERMANY	Customer#000000136,Customer#000000062,Customer#000000071,Customer#000000119	4
INDIA	Customer#000000115,Customer#000000028,Customer#000000091,Customer#000000037	4
INDONESIA	Customer#000000094,Customer#000000142,Customer#000000067,Customer#000000130,Customer#000000103,Customer#000000139	6
IRAN	Customer#000000055,Customer#000000041,Customer#000000110,Customer#000000049,Customer#000000056,Customer#000000104,Customer#000000016	7
IRAQ	Customer#000000134,Customer#000000131,Customer#000000052,Customer#000000148	4
JAPAN	Customer#000000038,Customer#000000025,Customer#000000068,Customer#000000098,Customer#000000113	5
JORDAN	Customer#000000145,Customer#000000002,Customer#000000058	3
KENYA	Customer#000000089	1
MOROCCO	Customer#000000107,Customer#000000032,Customer#000000053,Customer#000000095,Customer#000000034,Customer#000000001,Customer#000000079	7
MOZAMBIQUE	Customer#000000088,Customer#000000109,Customer#000000143,Customer#000000116,Customer#000000137,Customer#000000044	6
PERU	Customer#000000121,Customer#000000061,Customer#000000097,Customer#000000035,Customer#000000008,Customer#000000077,Customer#000000133	7
ROMANIA	Customer#000000149,Customer#000000043,Customer#000000125,Customer#000000112	4
RUSSIA	Customer#000000026,Customer#000000020,Customer#000000083,Customer#000000070	4
SAUDI ARABIA	Customer#000000100	1
UNITED KINGDOM	Customer#000000011,Customer#000000031,Customer#000000065	3
VIETNAM	Customer#000000127	1
SELECT n_name, GROUP_CONCAT(DISTINCT c_name), COUNT(DISTINCT c_name)
FROM customer, orders, nation
WHERE o_custkey= c_custkey and c_nationkey= n_nationkey GROUP BY n_name;
n_name	GROUP_CONCAT(DISTINCT c_name)	COUNT(DISTINCT c_name)
ALGERIA	Customer#000000029,Customer#000000073,Customer#000000076,Customer#000000080,Customer#000000086	5
ARGENTINA	Customer#000000014,Customer#000000059,Customer#000000106	3
BRAZIL	Customer#000000017,Customer#000000047,Customer#000000092,Customer#000000101	4
CANADA	Customer#000000005,Customer#000000013,Customer#000000022,Customer#000000023,Customer#000000040,Customer#000000064,Customer#000000122,Customer#000000146	8
CHINA	Customer#000000007,Customer#000000019,Customer#000000082,Customer#000000118,Customer#000000124	5
EGYPT	Customer#000000004,Customer#000000074,Customer#000000128,Customer#000000140	4
ETHIOPIA	Customer#000000010,Customer#000000085	2
FRANCE	Customer#000000046,Customer#000000050	2
GERMANY	Customer#000000062,Customer#000000071,Customer#000000119,Customer#000000136	4
INDIA	Customer#000000028,Customer#000000037,Customer#000000091,Customer#000000115	4
INDONESIA	Customer#000000067,Customer#000000094,Customer#000000103,Customer#000000130,Customer#000000139,Customer#000000142	6
IRAN	Customer#000000016,Customer#000000041,Customer#000000049,Customer#000000055,Customer#000000056,Customer#000000104,Customer#000000110	7
IRAQ	Customer#000000052,Customer#000000131,Customer#000000134,Customer#000000148	4
JAPAN	Customer#000000025,Customer#000000038,Customer#000000068,Customer#000000098,Customer#000000113	5
JORDAN	Customer#000000002,Customer#000000058,Customer#000000145	3
KENYA	Customer#000000089	1
MOROCCO	Customer#000000001,Customer#000000032,Customer#000000034,Customer#000000053,Customer#000000079,Customer#000000095,Customer#000000107	7
MOZAMBIQUE	Customer#000000044,Customer#000000088,Customer#000000109,Customer#000000116,Customer#000000137,Customer#000000143	6
PERU	Customer#000000008,Customer#000000035,Customer#000000061,Customer#000000077,Customer#000000097,Customer#000000121,Customer#000000133	7
ROMANIA	Customer#000000043,Customer#000000112,Customer#000000125,Customer#000000149	4
RUSSIA	Customer#000000020,Customer#000000026,Customer#000000070,Customer#000000083	4
SAUDI ARABIA	Customer#000000100	1
UNITED KINGDOM	Customer#000000011,Customer#000000031,Customer#000000065	3
VIETNAM	Customer#000000127	1
drop database dbt3;
